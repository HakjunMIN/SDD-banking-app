# 구현 계획: 계좌 이체 기능

**브랜치**: `002-transfer` | **날짜**: 2025-11-07 | **스펙**: [spec.md](./spec.md)
**입력**: `/specs/002-transfer/spec.md`의 기능 명세서

**참고**: 이 템플릿은 `/speckit.plan` 명령으로 작성됩니다.

## 요약

사용자가 다른 계좌로 이체를 실행하고, 가상의 타 은행 인터페이스를 통해 이체를 시뮬레이션할 수 있는 뱅킹 앱 이체 기능을 개발합니다. 이체 완료 후에는 해당 거래가 기존의 거래 내역 시스템에 자동으로 기록됩니다. 실제 금융 시스템과의 연동 없이 가상의 은행 인터페이스로 이체 동작을 시뮬레이션합니다.

## 기술적 컨텍스트

**Language/Version**: Python 3.11+ (백엔드), JavaScript/TypeScript (프론트엔드)
**Primary Dependencies**: FastAPI, SQLAlchemy, React 18, Tailwind CSS
**Storage**: SQLite (프로토타입용 경량 데이터베이스)
**Testing**: pytest (백엔드), Jest/Testing Library (프론트엔드)
**Target Platform**: 웹 브라우저 (데스크탑, 모바일 반응형)
**Project Type**: 웹 애플리케이션 (백엔드/프론트엔드 분리)
**Performance Goals**: 이체 처리 < 2초, API 응답 < 500ms, 유효성 검사 < 1초
**Constraints**: 프로토타입 목적으로 실제 은행 연동 없음, 가상 인터페이스 사용
**Scale/Scope**: 내부 계좌간 이체, 가상 타은행 이체, 거래 내역 연동

## 헌장 검사

*게이트: 0단계 연구 전 통과 필수. 1단계 설계 후 재검토.*

### 보안 우선 원칙 검토

**예외 승인됨**: 프로토타입 목적으로 보안 요구사항 완화
- ❌ 다중 인증: 사용자 요청으로 로그인 기능 제외
- ❌ 이체 한도 관리: 프로토타입에서 제외
- ❌ 실시간 사기 탐지: 시뮬레이션 환경에서 제외
- ✅ 잔액 검증: 기본적인 잔액 확인 로직 적용
- ✅ 입력 검증: API 엔드포인트에서 계좌번호, 금액 검증
- ❌ 암호화 통신: 로컬 개발 환경에서는 HTTP 허용

**근거**: 프로토타입 개발 목적으로 가상 은행 인터페이스를 통한 이체 시뮬레이션에 중점을 둡니다.

### 테스트 우선 개발 원칙

**수정 필요**: 명세서에서 테스트 작성을 명시적으로 요청하지 않았으므로 선택적으로 적용
- ✅ 기본 단위 테스트 포함 (이체 로직)
- ✅ API 엔드포인트 통합 테스트
- ✅ 가상 은행 인터페이스 모킹 테스트
- ❌ TDD 전체 적용: 프로토타입 빠른 개발 우선
- ✅ 80% 코드 커버리지 목표

### 모듈형 아키텍처 준수

- ✅ 백엔드/프론트엔드 명확한 분리
- ✅ API 우선 설계 (REST API)
- ✅ 이체 서비스 독립 모듈화
- ✅ 가상 은행 인터페이스 추상화
- ✅ 거래 내역 시스템과의 통합

### 성능 및 신뢰성

- ✅ 이체 처리 시간 < 2초 목표
- ✅ 잔액 부족 오류 처리
- ✅ 계좌번호 유효성 검증
- ✅ 네트워크 오류 시뮬레이션 및 처리
- ✅ 거래 원자성 보장

## 프로젝트 구조

### 문서화 (이 기능)

```text
specs/002-transfer/
├── plan.md              # 이 파일 (/speckit.plan 명령 출력)
├── research.md          # 0단계 출력 (/speckit.plan 명령)
├── data-model.md        # 1단계 출력 (/speckit.plan 명령)
├── quickstart.md        # 1단계 출력 (/speckit.plan 명령)
├── contracts/           # 1단계 출력 (/speckit.plan 명령)
└── tasks.md             # 2단계 출력 (/speckit.tasks 명령 - /speckit.plan에서 생성하지 않음)
```

### 소스 코드 확장 (기존 구조에 추가)

```text
backend/
├── src/
│   ├── models/          # Transfer 모델 추가
│   │   ├── transfer.py  # 이체 거래 엔티티
│   │   └── bank.py      # 가상 은행 정보 엔티티
│   ├── services/        
│   │   ├── transfer_service.py    # 이체 비즈니스 로직
│   │   └── bank_interface.py     # 가상 타 은행 인터페이스
│   ├── api/            
│   │   └── transfer.py  # 이체 API 라우터
│   ├── utils/          
│   │   └── validators.py # 계좌번호, 금액 검증
│   └── config/         
│       └── banks.py    # 가상 은행 설정
├── tests/
│   ├── unit/           
│   │   ├── test_transfer_service.py
│   │   └── test_bank_interface.py
│   └── integration/    
│       └── test_transfer_api.py
└── fixtures/
    └── mock_banks.py   # 가상 은행 테스트 데이터

frontend/
├── src/
│   ├── components/     
│   │   ├── TransferForm.tsx     # 이체 입력 폼
│   │   ├── AccountSelector.tsx  # 계좌 선택
│   │   ├── BankSelector.tsx     # 은행 선택
│   │   └── TransferConfirm.tsx  # 이체 확인
│   ├── pages/         
│   │   └── TransferPage.tsx     # 이체 메인 페이지
│   ├── services/      
│   │   └── transferAPI.ts       # 이체 API 클라이언트
│   ├── utils/         
│   │   └── formatters.ts        # 금액, 계좌번호 포매팅
│   └── hooks/         
│       └── useTransfer.ts       # 이체 상태 관리
└── types/
    └── transfer.ts     # 이체 관련 타입 정의
```

**구조 결정**: 기존의 거래 내역 시스템과 통합되도록 설계했습니다. 이체 기능은 독립적인 모듈로 개발하되, Transfer 모델을 통해 기존의 Transaction 테이블에 이체 완료 기록이 자동으로 저장되도록 합니다.

## 주요 기능 요구사항

### 1. 이체 유형 지원
- **내부 계좌간 이체**: 같은 은행 내 다른 계좌로 이체
- **타 은행 이체**: 가상의 다른 은행으로 이체 (시뮬레이션)
- **즉시 이체**: 실시간 처리 시뮬레이션

### 2. 가상 은행 인터페이스
- **다양한 은행**: 국민은행, 신한은행, 우리은행, 하나은행 등 시뮬레이션
- **응답 시뮬레이션**: 성공, 실패, 지연 등 다양한 시나리오
- **계좌번호 검증**: 각 은행별 계좌번호 형식 검증

### 3. 거래 내역 통합
- **자동 기록**: 이체 완료 시 거래 내역에 자동 등록
- **거래 타입**: "출금"(이체 송금), "입금"(이체 수신) 구분
- **상세 정보**: 수취인, 은행명, 수수료 등 상세 정보 포함

### 4. 유효성 검증
- **잔액 확인**: 송금 계좌 잔액 부족 검사
- **한도 검증**: 1회 이체 한도 (프로토타입: 100만원)
- **계좌번호**: 수취계좌 존재 여부 및 형식 검증

## 복잡도 추적

> **헌장 검사 위반이 있고 정당화가 필요한 경우에만 작성**

| 위반 | 필요한 이유 | 더 간단한 대안이 거부된 이유 |
|-----------|------------|-------------------------------------|
| 보안 우선 원칙 완화 | 프로토타입 빠른 개발 및 가상 은행 시뮬레이션 | 실제 금융 보안 구현은 개발 복잡도를 10배 증가시킴 |
| 실제 은행 연동 제외 | 사용자가 가짜 인터페이스 명시적 요청 | 실제 은행 API 연동은 프로토타입 범위를 초과 |

## 플래닝 준비 단계

### 📋 다음 작업 계획

1. **연구 문서 작성**: 이체 시스템 아키텍처 및 가상 은행 인터페이스 패턴 조사
2. **데이터 모델 설계**: Transfer, Bank 엔티티 및 기존 Transaction 모델과의 관계 정의
3. **API 계약 작성**: 이체 관련 엔드포인트 OpenAPI 명세서 작성
4. **퀵스타트 가이드**: 이체 기능 개발 환경 설정 방법

### 🎯 핵심 설계 원칙

- **기존 시스템 통합**: 거래 내역 조회 시스템과 seamless 통합
- **모듈화**: 이체 기능을 독립적인 서비스로 구현
- **확장성**: 향후 실제 은행 API 연동 가능하도록 추상화
- **사용자 경험**: 직관적인 이체 프로세스 및 명확한 피드백

**플래닝 초기 단계가 완료되었습니다.** 이제 상세한 연구와 설계 단계로 진행할 준비가 되었습니다.
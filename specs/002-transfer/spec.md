# 기능 명세서: 계좌 이체 기능

**Feature Branch**: `002-transfer`  
**Created**: 2025-11-07  
**Status**: Draft  
**Input**: User description: "이체 기능을 만들고 싶어. 이체가 타 은행과 인터페이스가 가짜로 되도록 해서 이체기능을 구현할꺼야. 이체완료내역이 거래히스토리에 들어가야해"

## 사용자 시나리오 및 테스트 *(필수)*

### 사용자 스토리 1 - 같은 은행 내 계좌간 이체 (우선순위: P1)

사용자가 자신의 계좌에서 같은 은행의 다른 계좌로 이체를 할 수 있습니다. 수취인 계좌번호, 이체금액, 받는분 성명을 입력하고 이체를 실행합니다. 이체 완료 후 거래 내역에 출금 기록이 자동으로 추가됩니다.

**이 우선순위인 이유**: 이체의 가장 기본적인 형태이며, 복잡한 외부 은행 연동 없이 내부 로직으로만 처리 가능합니다.

**독립적 테스트**: 샘플 계좌 데이터를 사용하여 이체 폼을 작성하고 이체 실행 후 거래 내역에 기록되는지 확인할 수 있습니다.

**승인 시나리오**:

1. **Given** 사용자가 이체 페이지에 접속했을 때, **When** 수취인 계좌번호, 이체금액, 받는분 성명을 입력하고 이체 버튼을 클릭하면, **Then** 이체가 성공적으로 처리되고 확인 메시지가 표시됩니다.
2. **Given** 이체가 완료된 상태에서, **When** 거래 내역 페이지를 확인하면, **Then** 해당 이체 건이 출금 거래로 기록되어 있습니다.

---

### 사용자 스토리 2 - 타 은행으로 이체 (가상 인터페이스) (우선순위: P2)

사용자가 자신의 계좌에서 다른 은행의 계좌로 이체를 할 수 있습니다. 은행 선택, 수취인 계좌번호, 이체금액, 받는분 성명을 입력합니다. 실제 은행 API 대신 가상의 은행 인터페이스를 통해 이체를 시뮬레이션하며, 성공/실패/지연 등 다양한 응답을 시뮬레이션합니다.

**이 우선순위인 이유**: 사용자 요구사항의 핵심인 "타 은행과 인터페이스가 가짜로 되도록" 하는 기능으로, 실제 은행 연동 없이 이체 경험을 시뮬레이션할 수 있습니다.

**독립적 테스트**: 다른 은행을 선택하여 이체를 시도하고, 가상 인터페이스의 응답에 따른 처리 결과를 확인할 수 있습니다.

**승인 시나리오**:

1. **Given** 사용자가 이체 페이지에서 타 은행을 선택했을 때, **When** 이체 정보를 입력하고 실행하면, **Then** 가상 은행 인터페이스를 통해 이체가 처리되고 결과가 표시됩니다.
2. **Given** 타 은행 이체가 성공한 상태에서, **When** 거래 내역을 확인하면, **Then** 이체 내역이 은행명과 함께 기록되어 있습니다.

---

### 사용자 스토리 3 - 이체 확인 및 취소 기능 (우선순위: P3)

사용자가 이체 정보 입력 완료 후 최종 확인 단계에서 이체 내용을 검토하고, 필요시 취소할 수 있습니다. 확인 화면에서는 송금 계좌, 수취 계좌, 금액, 수수료를 명확하게 표시합니다.

**이 우선순위인 이유**: 금융 거래의 안전성을 위한 기능이지만, 프로토타입에서는 기본 이체 기능 구현 이후 추가할 수 있는 편의 기능입니다.

**독립적 테스트**: 이체 정보 입력 후 확인 페이지가 표시되고, 취소 버튼으로 이전 단계로 돌아갈 수 있는지 확인할 수 있습니다.

**승인 시나리오**:

1. **Given** 사용자가 이체 정보를 입력하고 다음 버튼을 클릭했을 때, **When** 확인 페이지가 표시되면, **Then** 입력한 모든 정보가 정확하게 표시되고 확인/취소 버튼이 제공됩니다.

---

### 엣지 케이스

- 잔액이 부족한 경우 어떻게 처리할 것인가?
- 수취 계좌번호가 존재하지 않거나 형식이 잘못된 경우는?
- 가상 은행 인터페이스에서 네트워크 오류나 타임아웃이 발생한 경우는?
- 이체 한도를 초과한 금액을 입력한 경우는?
- 동시에 여러 이체를 시도하는 경우는?

## 요구사항 *(필수)*

### 기능적 요구사항

- **FR-001**: 시스템은 내부 계좌간 이체를 실시간으로 처리해야 합니다.
- **FR-002**: 시스템은 타 은행 이체를 위한 가상 인터페이스를 제공해야 합니다.
- **FR-003**: 시스템은 이체 전 송금 계좌의 잔액을 확인해야 합니다.
- **FR-004**: 시스템은 수취 계좌번호의 형식을 검증해야 합니다.
- **FR-005**: 시스템은 이체 완료 후 거래 내역에 자동으로 기록해야 합니다.
- **FR-006**: 시스템은 1회 이체 한도(100만원)를 설정하고 검증해야 합니다.
- **FR-007**: 시스템은 최소 5개 이상의 가상 은행(국민, 신한, 우리, 하나, 기업은행)을 지원해야 합니다.
- **FR-008**: 시스템은 이체 수수료를 계산하고 표시해야 합니다 (같은 은행: 무료, 타 은행: 500원).
- **FR-009**: 시스템은 가상 은행 응답을 시뮬레이션해야 합니다 (성공, 실패, 지연).

### 주요 엔티티

- **이체(Transfer)**: 이체 고유ID, 송금계좌, 수취계좌, 수취은행, 이체금액, 수수료, 받는분성명, 이체상태, 이체일시를 포함
- **가상은행(VirtualBank)**: 은행코드, 은행명, 응답지연시간, 성공확률을 포함
- **계좌(Account)**: 기존 엔티티에 이체 기능 연동

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: 사용자가 내부 계좌간 이체를 2분 이내에 완료할 수 있습니다.
- **SC-002**: 시스템은 이체 처리 시간을 2초 이내로 유지해야 합니다.
- **SC-003**: 가상 은행 인터페이스는 95% 이상의 성공률을 시뮬레이션해야 합니다.
- **SC-004**: 이체 완료 후 거래 내역에 100% 정확하게 기록되어야 합니다.
- **SC-005**: 잘못된 계좌번호 입력 시 즉시 오류를 감지해야 합니다.

## 가정사항

- 단일 계좌에서의 송금만 지원 (다중 계좌 관리 불필요)
- 수취인 계좌 실명확인 시뮬레이션 (실제 확인 불필요)
- 24시간 이체 가능 (영업시간 제한 없음)
- 모든 이체는 즉시 처리 (예약이체 불필요)
- 가상 은행들은 모두 동일한 인터페이스 규격 사용
- 이체 취소 기능은 이체 실행 전에만 가능

## 범위 제외사항

- 실제 은행 API 연동
- 실명 확인 시스템 연동
- 이체 예약 기능
- 정기 이체 기능
- 해외 송금
- 대량 이체
- 이체 한도 변경 기능
- 이체 내역 인쇄/내보내기
- 이체 실행 후 취소 기능

## 지원 은행 및 이체 시나리오

### 대상 은행

시스템은 다음 주요 은행들로의 이체를 지원합니다:
- 국민은행
- 신한은행  
- 우리은행
- 하나은행
- 기업은행

### 이체 시나리오

사용자는 다양한 이체 결과를 경험할 수 있습니다:
- **즉시 완료**: 대부분의 이체가 즉시 처리됨
- **처리 지연**: 일시적으로 처리가 지연되는 경우
- **이체 실패**: 계좌 오류, 한도 초과, 시스템 장애 등의 경우

### 거래 내역 기록

이체 완료 후 거래 내역에는 다음 정보가 기록됩니다:
- 이체 유형 구분 (출금)
- 수취은행과 수취인 정보
- 이체 수수료 내역
- 이체 처리 결과 상태